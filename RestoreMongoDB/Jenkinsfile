pipeline {
    stage('Download backup') {
        withAWS(credentials: 'awscredentials') {
            s3Download(file: KEY_BACKUP_ENV, bucket: 'backups', path:'~/backups')
        }
    }

    stage('unzip backup') {
      sh 'unzip ~/backups/${KEY_BACKUP_ENV}'
    }

    stage('restore') {
      sh 'mongorestore --uri="${MONGO_HOST}" --db=${MONGO_DB} ~/backups --gzip'
    }

    stage('Delete backup') {
      sh 'rm -r ~/backups'
    }
}
